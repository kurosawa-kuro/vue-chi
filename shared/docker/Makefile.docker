# Makefile.docker - å…±é€šDockeræ“ä½œ

DOCKER_COMPOSE_FILE := $(SHARED_DIR)/docker/docker-compose.yml
DOCKER_COMPOSE_E2E_FILE := $(SHARED_DIR)/docker/docker-compose.e2e.yml

.PHONY: docker docker-bg docker-down docker-frontend docker-backend docker-logs docker-ps docker-clean e2e-test e2e-up e2e-down

docker:
	@echo "ğŸ³ Docker Composeã§å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build

docker-bg:
	@echo "ğŸ³ Docker Composeã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up -d --build

docker-down:
	@echo "ğŸ³ Docker Composeã§åœæ­¢ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) down

docker-frontend:
	@echo "ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã®ã¿èµ·å‹•ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build frontend

docker-backend:
	@echo "âš™ï¸  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã®ã¿èµ·å‹•ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build backend db

docker-logs:
	@echo "ğŸ“‹ Docker Composeã®ãƒ­ã‚°ã‚’è¡¨ç¤ºä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) logs -f

docker-ps:
	@echo "ğŸ“Š å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§..."
	docker compose -f $(DOCKER_COMPOSE_FILE) ps

docker-clean:
	@echo "ğŸ§¹ Dockerã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_FILE) down -v --remove-orphans
	docker system prune -f

# E2E ãƒ†ã‚¹ãƒˆé–¢é€£ã‚³ãƒãƒ³ãƒ‰
e2e-up:
	@echo "ğŸ§ª E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’èµ·å‹•ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) up -d --build backend frontend db

e2e-test:
	@echo "ğŸ­ Playwright E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) up --build e2e-tests

e2e-down:
	@echo "ğŸ§ª E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åœæ­¢ä¸­..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) down -v --remove-orphans

e2e-logs:
	@echo "ğŸ“‹ E2Eãƒ†ã‚¹ãƒˆã®ãƒ­ã‚°ã‚’è¡¨ç¤ºä¸­..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) logs -f e2e-tests