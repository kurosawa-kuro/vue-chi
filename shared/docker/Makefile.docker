# Makefile.docker - 共通Docker操作

DOCKER_COMPOSE_FILE := $(SHARED_DIR)/docker/docker-compose.yml
DOCKER_COMPOSE_E2E_FILE := $(SHARED_DIR)/docker/docker-compose.e2e.yml

.PHONY: docker docker-bg docker-down docker-frontend docker-backend docker-logs docker-ps docker-clean e2e-test e2e-up e2e-down

docker:
	@echo "🐳 Docker Composeで全サービス起動中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build

docker-bg:
	@echo "🐳 Docker Composeでバックグラウンド起動中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up -d --build

docker-down:
	@echo "🐳 Docker Composeで停止中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) down

docker-frontend:
	@echo "🎨 フロントエンドコンテナのみ起動中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build frontend

docker-backend:
	@echo "⚙️  バックエンドコンテナのみ起動中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) up --build backend db

docker-logs:
	@echo "📋 Docker Composeのログを表示中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) logs -f

docker-ps:
	@echo "📊 実行中のコンテナ一覧..."
	docker compose -f $(DOCKER_COMPOSE_FILE) ps

docker-clean:
	@echo "🧹 Dockerのクリーンアップ中..."
	docker compose -f $(DOCKER_COMPOSE_FILE) down -v --remove-orphans
	docker system prune -f

# E2E テスト関連コマンド
e2e-up:
	@echo "🧪 E2Eテスト環境を起動中..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) up -d --build backend frontend db

e2e-test:
	@echo "🎭 Playwright E2Eテストを実行中..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) up --build e2e-tests

e2e-down:
	@echo "🧪 E2Eテスト環境を停止中..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) down -v --remove-orphans

e2e-logs:
	@echo "📋 E2Eテストのログを表示中..."
	docker compose -f $(DOCKER_COMPOSE_E2E_FILE) logs -f e2e-tests